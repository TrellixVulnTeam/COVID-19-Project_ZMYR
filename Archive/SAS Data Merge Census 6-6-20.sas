
PROC DATASETS NOPRINT LIB=WORK KILL;
RUN;
QUIT;

DM LOG "CLEAR;";

%macro importer(dset, file);
proc import out = T_&dset datafile= "C:\Users\Daniel chacreton\Documents\Python\USF\COVID-19 Project\Data\&file"
dbms = xlsx replace;
getnames= yes;
datarow = 2;
run;

data &dset;
LENGTH COUNTY $20.;
set t_&dset;
if  find(geo_id, "id", "i") then delete;

County = upcase(substr(name, 1, index(name," County")));
run;


proc sort data =&dset;
by COUNTY;
run;

%mend;

%importer(inc1  ,Census\Florida 2018 Median Income.xlsx);
%importer(Edu1  ,Census\Florida Education 2018.xlsx);
%importer(Race1 ,Census\Florida Race & Pop 2018.xlsx);
%importer(AGE1 ,Census\Florida Median Age 2018.xlsx);

%MACRO SORTI(DSET, VAR1, VAR2, VAR3);
PROC SORT DATA =&DSET;
BY &VAR1 &VAR2 &VAR3;
RUN;
%MEND;

DATA INC;
SET INC1;
KEEP S1901_C01_012E COUNTY;
RUN;

DATA RACE;
SET RACE1;
KEEP COUNTY DP05_0001E DP05_0037PE DP05_0038PE DP05_0039PE DP05_0044PE DP05_0052PE;
RUN ;


DATA AGE;
SET AGE1;
KEEP COUNTY S0101_C01_032E;
RUN ;

DATA EDU;
SET EDU1;
KEEP COUNTY S1501_C02_002E S1501_C02_009E ;
RUN ;

%SORTI(AGE, COUNTY);
%SORTI(EDU , COUNTY);
%SORTI(INC , COUNTY);
%SORTI(RACE , COUNTY);

DATA FINAL_CENSUS;
MERGE AGE EDU INC RACE;
BY COUNTY;
RUN;

PROC DATASETS NOPRINT; 
DELETE AGE AGE1 EDU EDU1 INC INC1 RACE RACE1 t_INC1 T_EDU1 T_AGE1 T_RACE1;
RUN;
QUIT;

proc import out = covid1 datafile= "C:\Users\Daniel chacreton\Documents\Python\USF\COVID-19 Project\Data\FINAL COVID DATA SET (6-6-20).xlsx"
DBMS = XLSX REPLACE;
GETNAMES = YES;
DATAROW=2;
RUN;

DATA COVID;
SET COVID1;
COUNTY = UPCASE(COUNTY);
ARRAY CONSOL AWAITING_TESTING AWAITING_BPHL_TESTING AWAITING_TESTING_1;
	DO OVER CONSOL;
	IF CONSOL NE . THEN AWAIT_TEST = CONSOL;
	END;
ARRAY CONSOL2 TOTAL_TESTED TOTAL;
	DO OVER CONSOL2;
	IF CONSOL2 NE . THEN TOT = CONSOL2;
	END;
IF AWAIT_TEST =. THEN AWAIT_TEST = 0;
IF INCONCLUSIVE =. THEN INCONCLUSIVE = 0;
IF COUNTY = "" THEN COUNTY = "UNKOWN";
DROP AWAITING_TESTING AWAITING_BPHL_TESTING AWAITING_TESTING_1 TOTAL_TESTED TOTAL;
RENAME AWAIT_TEST = AWAITING_TESTING TOT = TOTAL_TESTED;

RUN;

%SORTI(COVID, COUNTY);
%SORTI(FINAL_CENSUS, COUNTY);
/**/
/*DM LOG "CLEAR;";*/

DATA FINAL_COMPLETE;
LENGTH COUNTY $20.;
MERGE COVID FINAL_CENSUS;
BY COUNTY;
KEEP COUNTY AWAITING_TESTING	INCONCLUSIVE	NEGATIVE	POSITIVE	PERCENT_POSITIVE	TOTAL_TESTED	
DATE	FILE_NAME	TOTAL S0101_C01_032E 	S1901_C01_012E S1501_C02_002E S1501_C02_009E DP05_0001E 
DP05_0037PE DP05_0038PE DP05_0039PE DP05_0044PE DP05_0052PE;
RUN;
QUIT;

/*
PROC EXPORT DATA = FINAL OUTFILE = "C:\Users\Daniel chacreton\Documents\Python\USF\COVID-19 Project\Data\Complete COVID Dataset 6-6-20"
DBMS = XLSX REPLACE;
RUN;
